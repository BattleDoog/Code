<!DOCTYPE html>
<html>
	<head>
		<title>Space</title>
		<style type="text/css">
			#mainCanv{
				background-color:black;
			}
		</style>
	</head>
	<body>
		<canvas id="mainCanv" width="1400" height="750"></canvas>
		<script type="text/javascript">
			var mainCanv = document.getElementById("mainCanv");
			var ctx = mainCanv.getContext("2d");

			var gridSpace = 75;

			var worldWidth = 10000;
			var worldHeight = 10000;

			var canvWidth = mainCanv.width;
			var canvHeight = mainCanv.height;

			//character
			var centerX = 17; //approximate values, dependent on draw func
			var centerY = 24;
			var charX = worldWidth/2;
			var charY = worldHeight/2;
			var totalMass = 30;
			var charModel;

			var aDown = false;
			var dDown = false;
			var wDown = false;
			var sDown = false;

			function renderFunction(width, height, renderFunction) {
			    var buffer = document.createElement('canvas');
			    buffer.width = width;
			    buffer.height = height;
			    renderFunction(buffer.getContext('2d'));
			    return buffer;
			}

			//create character model
			charModel = renderFunction(34, 44, function (ctx){
				ctx.beginPath();
				ctx.moveTo(2,42);
				ctx.lineTo(17,2);
				ctx.lineTo(32,42);
				ctx.arc(17,48,15,-Math.PI/4+Math.PI/5,-3*Math.PI/4-Math.PI/5,true);
				ctx.closePath();
				ctx.strokeStyle = "white";
				ctx.lineWidth = 3;
				ctx.stroke();
			});

			function drawGrid(x,y){
				var xOff = (x - canvWidth/2) % gridSpace;
				var yOff = (y - canvHeight/2) % gridSpace;

				var xLinesToDraw = canvWidth/gridSpace;
				var yLinesToDraw = canvHeight/gridSpace;

				ctx.strokeStyle = "lightGray";
				ctx.lineWidth = 0.3;

				ctx.beginPath();

				for (var i = -1; i < xLinesToDraw + 1; i++){
					ctx.moveTo(gridSpace*i - xOff, 0);
					ctx.lineTo(gridSpace*i - xOff, canvHeight);
				}

				for (var i = -1; i < yLinesToDraw + 1; i++){
					ctx.moveTo(0, gridSpace*i - yOff);
					ctx.lineTo(canvWidth, gridSpace*i - yOff);
				}

				ctx.moveTo(xOff, 0);
				ctx.closePath();

				ctx.stroke();

				ctx.beginPath();
				ctx.lineWidth = 1;
				ctx.strokeStyle = "white";

				if (y < canvHeight/2){ //upper left corner
					ctx.moveTo(0, canvHeight/2 - y);
					ctx.lineTo(canvWidth, canvHeight/2 - y);
					ctx.moveTo(0, canvHeight/2 - y);
				} else if (y > worldHeight - canvHeight/2) { //lower left corner
					ctx.moveTo(0, worldHeight + canvHeight/2 - y);
					ctx.lineTo(canvWidth, worldHeight + canvHeight/2 - y);
					ctx.moveTo(0, worldHeight + canvHeight/2 - y);
				}

				if (x < canvWidth/2){
					ctx.moveTo(canvWidth/2 - x, 0);
					ctx.lineTo(canvWidth/2 - x, canvHeight);
					ctx.moveTo(canvWidth/2 - x, 0);
				} else if (x > worldWidth - canvWidth/2){
					ctx.moveTo(worldWidth + canvWidth/2 - x, 0);
					ctx.lineTo(worldWidth + canvWidth/2 - x, canvHeight);
					ctx.moveTo(worldWidth + canvWidth/2 - x, 0);
				}

				ctx.closePath();
				ctx.stroke();
			}

			function checkKeysDown(e){
				if (e.keyCode == 65){
					aDown = true;
				}
				if (e.keyCode == 68){
					dDown = true;
				}
				if (e.keyCode == 87){
					wDown = true;
				}
				if (e.keyCode == 83){
					sDown = true;
				}
			}

			function checkKeysUp(e){
				if (e.keyCode == 65){
					aDown = false;
				}
				if (e.keyCode == 68){
					dDown = false;
				}
				if (e.keyCode == 87){
					wDown = false;
				}
				if (e.keyCode == 83){
					sDown = false;
				}
			}

			function resolveForce(fCX, fCY, fX, fY, mFC){ //fCX and FCY are the distances from point of force to center of mass. fX and fY is the force. Returns an object: {towards:..., normal:...} Towards is the amount of force towards the center of mass, normal is the amount normal to it. Also takes magnitude of FC, which is optional. It will be ignored if it is 0.
				var mag = 1;
				if (mFC === 0){
					var magSquared = fCX*fCX + fCY*fCY;
					if (magSquared === 0){
						return false;
					} else {
						mag = Math.sqrt(magSquared);
					}
				} else {
					mag = mFC;
				}

				var dot = fX*fCX + fY*fCY;
				var proj = dot/mag;

				var projVecX = fCX * dot/mag;
				var projVecY = fCY * dot/mag;

				/*
				dot product = fX*fCX + fY*fCY

				projection of f onto fC = dot product / magnitude fC
				orthagonal of f onto fC = projVec - projection of f onto fC


				*/
			}

			document.body.onkeydown = checkKeysDown;
			document.body.onkeyup = checkKeysUp;
		</script>
	</body>
</html>